<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ | Pro Ticketing System</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* --- ğŸ¨ CSS - Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø­Ø±ÙƒÙŠØ© --- */
        /* --- ğŸ¨ CSS - Ù„ÙˆØ­Ø© Ø£Ù„ÙˆØ§Ù† Ù‡ÙƒØ§ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© --- */
:root {
    /* Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
    --main-bg: #F8F9FA;        /* Cloud White */
    --sidebar-color: #2C3E50;  /* Dark Charcoal */
    --accent-color: #2EB886;   /* HAKA Green */
    
    /* Ø£Ù„ÙˆØ§Ù† Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ */
    --soft-silver: #E9ECEF;
    --white: #ffffff;
    --success: #2EB886;
    --warning: #f59e0b;
    --danger: #e74c3c;
    
    --transition: all 0.3s ease;
}

/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª Ù„ØªØ¸Ù‡Ø± Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶Ù‡Ø§ */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
    margin-top: 20px;
}

.chart-box {
    background: #fafafa;
    border-radius: 12px;
    padding: 15px;
    min-height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--main-bg);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            font-size: 11px; /* Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨: Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø§Ø¯ÙŠ 11 */
        }

        h1, h2, h3, h4 { font-size: 14px; font-weight: 700; margin-bottom: 15px; } /* Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨: Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† 14 */
        b, strong { font-weight: 700; }

        /* Sidebar Style */
        .sidebar {
            width: 260px;
            background: var(--sidebar-color);
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px;
            transition: var(--transition);
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar .logo {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 15px;
        }

        .nav-item {
            padding: 12px 15px;
            margin: 5px 0;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
        }

        .nav-item:hover, .nav-item.active {
            background: var(--accent-color);
            transform: translateX(-5px);
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            position: relative;
        }

        .top-bar {
            background: var(--white);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .container { padding: 30px; }

        /* Cards & Sections */
        .section-view {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .section-view.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .glass-card {
            background: var(--white);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            margin-bottom: 25px;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-item {
            padding: 20px;
            border-radius: 12px;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: transform 0.3s;
        }

        .stat-item:hover { transform: scale(1.05); }
        .bg-blue { background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); }
        .bg-orange { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .bg-green { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        th { background: #f8f9fa; color: #777; padding: 15px; text-align: right; }
        td { padding: 15px; border-bottom: 1px solid #eee; }

        /* Forms */
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: #555; }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            outline: none;
            transition: 0.3s;
        }
        input:focus { border-color: var(--accent-color); box-shadow: 0 0 5px rgba(0,188,212,0.2); }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary { background: var(--accent-color); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }

        /* Modal */
        .overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        /* Status Badges */
        .badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 10px;
            font-weight: bold;
        }
        .badge-pending { background: #fff3e0; color: #ef6c00; }
        .badge-done { background: #e8f5e9; color: #2e7d32; }




/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø­Ø±ÙƒØ© Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
.stat-item {
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Ø­Ø±ÙƒØ© Ù…Ø±Ù†Ø© */
    cursor: pointer;
}

.stat-item:hover {
    transform: translateY(-10px) scale(1.05); /* ØªØ±ØªÙØ¹ Ù„Ù„Ø£Ø¹Ù„Ù‰ ÙˆØªÙƒØ¨Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    box-shadow: 0 15px 30px rgba(0,0,0,0.2); /* Ø¸Ù„ Ø¹Ù…ÙŠÙ‚ */
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ø¸Ù‡ÙˆØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù… */
@keyframes sectionEntry {
    from { opacity: 0; transform: scale(0.95); filter: blur(5px); }
    to { opacity: 1; transform: scale(1); filter: blur(0); }
}

.section-view.active {
    display: block;
    animation: sectionEntry 0.5s ease-out;
}



/* ØªÙ†Ø³ÙŠÙ‚ Ø´Ø¨ÙƒØ© Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ù„ØªØ¸Ù‡Ø± Ø¬Ù†Ø¨Ù‹Ø§ Ø¥Ù„Ù‰ Ø¬Ù†Ø¨ */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.chart-box {
    background: #f8fafc; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ù‡Ø§Ø¯Ø¦ */
    padding: 15px;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    min-height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.chart-box h4 {
    margin-bottom: 15px;
    color: #475569;
    font-size: 12px;
}

/* ØªØ¹Ø¯ÙŠÙ„ Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„ØªÙƒÙˆÙ† Ø±Ø³Ù…ÙŠØ© Ø£ÙƒØ«Ø± */
.bg-blue { background: #1e293b !important; } /* ÙƒØ­Ù„ÙŠ Ø¯Ø§ÙƒÙ† */
.bg-orange { background: #f59e0b !important; } /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù…Ø·ÙÙŠ */
.bg-green { background: #10b981 !important; } /* Ø£Ø®Ø¶Ø± Ù‡Ø§Ø¯Ø¦ */

    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo">
    <i class="fas fa-ticket-alt"></i> HAKA IT SYSTEM
</div>
        <div class="nav-item active" onclick="switchTab('user-portal', this)">
            <i class="fas fa-plus-circle"></i> Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ (User)
        </div>
		<div class="nav-item" onclick="switchTab('track-status', this)">
    <i class="fas fa-search"></i> ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ùƒ (Track)
</div>
        <div class="nav-item" onclick="switchTab('login-view', this)">
            <i class="fas fa-user-shield"></i> Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        </div>
        <div id="admin-links" style="display: none; margin-top: 20px; border-top: 1px solid #333; padding-top: 10px;">
            <div class="nav-item" onclick="switchTab('admin-dashboard', this)">
                <i class="fas fa-chart-line"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </div>
            <div class="nav-item" onclick="switchTab('ticket-management', this)">
                <i class="fas fa-tasks"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ°Ø§ÙƒØ±
            </div>
            <div id="super-admin-only" style="display: none;">
                <div class="nav-item" onclick="switchTab('admin-management', this)">
                    <i class="fas fa-users-cog"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†
                </div>
            </div>
            <div class="nav-item" onclick="logout()" style="color: #ff5252;">
                <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <h2 id="view-title">Ø¨ÙˆØ§Ø¨Ø© ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
            <div id="user-badge" class="badge badge-pending">ÙˆØ¶Ø¹ÙŠØ© Ø§Ù„Ø²Ø§Ø¦Ø± ğŸ‘¤</div>
        </div>

        <div class="container">
            
            <section id="user-portal" class="section-view active">
                <div class="glass-card">
                    <h3>ğŸ“„ ÙØªØ­ Ø¨Ù„Ø§Øº Ù…Ø´ÙƒÙ„Ø© ØªÙ‚Ù†ÙŠØ©</h3>
                    <form id="ticketForm">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="input-group">
    <label>Ø§Ù„Ø´Ø±ÙƒØ©</label>
    <select id="u-company" required>
        <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„ØªØ§Ø¨Ø¹Ø© Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ù‡ÙƒØ§...</option>
        <option value="Haka group">Haka group</option>
        <option value="Rikaz">Rikaz</option>
        <option value="zaya">zaya</option>
        <option value="Fadeco">Fadeco</option>
        <option value="HFI">HFI</option>
        <option value="GH Transport">GH Transport</option>
        <option value="Haka resources">Haka resources</option>
        <option value="Haka Properties">Haka Properties</option>
        <option value="GIMA">GIMA</option>
        <option value="azdan">azdan</option>
        <option value="salyl">salyl</option>
        <option value="Haka foundation">Haka foundation</option>
    </select>
</div>
                            <div class="input-group">
                                <label>Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                                <input type="text" id="u-name" required placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="input-group">
    <label>Ø§Ù„Ù‚Ø³Ù…</label>
    <select id="u-dept" required>
        <option value="" disabled selected>Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…...</option>
        <option value="Finance">Finance</option>
        <option value="IT">IT</option>
        <option value="CC">CC</option>
        <option value="Operation">Operation</option>
        <option value="Marketing">Marketing</option>
        <option value="Sales">Sales</option>
        <option value="Admin">Admin</option>
        <option value="Logistics">Logistics</option>
    </select>
</div>
                            <div class="input-group">
                                <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</label>
                                <select id="u-risk">
                                    <option value="low">ğŸŸ¢ Ù…Ù†Ø®ÙØ¶</option>
                                    <option value="medium">ğŸŸ¡ Ù…ØªÙˆØ³Ø·</option>
                                    <option value="high">ğŸ”´ Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø¨Ø§Ù„ØªÙØµÙŠÙ„</label>
                            <textarea id="u-desc" rows="4" required placeholder="Ø§Ø´Ø±Ø­ Ù…Ø§ Ø­Ø¯Ø« Ù…Ø¹Ùƒ..."></textarea>
                        </div>
                        <div class="input-group">
    <label>Ø¥Ø±ÙØ§Ù‚ Ù…Ù„Ù/ØµÙˆØ±Ø© (Ø¥Ù„Ø²Ø§Ù…ÙŠ) ğŸ“</label>
    <input type="file" id="u-file" required>
</div>

<div class="input-group">
    <label>Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) ğŸ“±</label>
    <input type="text" id="u-contact" placeholder="05xxxxxxxx">
</div>
						<div class="input-group">
        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="u-email" required placeholder="example@haka.com.sa">
    </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ°ÙƒØ±Ø© Ø§Ù„Ø¢Ù† </button>
                    </form>
                </div>
            </section>

<section id="track-status" class="section-view">
    <div class="glass-card">
        <h3>ğŸ” ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø¨Ù„Ø§Øº</h3>
        <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø© Ø§Ù„Ø°ÙŠ Ø­ØµÙ„Øª Ø¹Ù„ÙŠÙ‡ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¢Ø®Ø± Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª.</p>
        
        <div style="display: flex; gap: 10px; margin-bottom: 25px;">
            <input type="text" id="track-id-input" placeholder="Ù…Ø«Ø§Ù„: TKT-1234" style="flex: 1;">
            <button class="btn btn-primary" onclick="trackTicket()">Ø¨Ø­Ø« ğŸ”</button>
        </div>

        <div id="track-result" style="display: none; border-top: 1px solid #eee; padding-top: 20px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</label>
                    <div id="res-status"></div>
                </div>
                <div>
                    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…:</label>
                    <div id="res-date" style="font-weight: bold;"></div>
                </div>
            </div>
            <div class="input-group" style="margin-top: 20px;">
                <label>ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªÙŠ Ù‚Ø¯Ù…ØªÙ‡Ø§:</label>
                <p id="res-desc" style="background: #f9f9f9; padding: 10px; border-radius: 8px;"></p>
            </div>
            <div class="input-group">
                <label>Ø±Ø¯ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ (Reply):</label>
                <div id="res-reply" style="background: #e3f2fd; padding: 15px; border-radius: 8px; color: #1565c0; font-weight: bold; border-right: 4px solid var(--accent-color);">
                    Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø¯ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†..
                </div>
            </div>
        </div>
    </div>
</section>


            <section id="login-view" class="section-view">
                <div class="glass-card" style="max-width: 400px; margin: auto; text-align: center;">
                    <i class="fas fa-lock-open" style="font-size: 40px; color: var(--accent-color); margin-bottom: 20px;"></i>
                    <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
                    <div class="input-group">
                        <input type="text" id="login-user" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                    </div>
                    <div class="input-group">
                        <input type="password" id="login-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                    </div>
                    <button class="btn btn-primary" onclick="handleLogin()" style="width: 100%; justify-content: center;">Ø¯Ø®ÙˆÙ„</button>
                    <p style="margin-top: 15px; color: #888;"></p>
                </div>
            </section>

            <section id="admin-dashboard" class="section-view">
    <div class="stats-grid">
        <div class="stat-item bg-blue">
            <h4 id="stat-total">0</h4>
            <b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ°Ø§ÙƒØ±</b>
        </div>
        <div class="stat-item bg-orange">
            <h4 id="stat-pending">0</h4>
            <b>ØªÙ†ØªØ¸Ø± Ø§Ù„Ø­Ù„</b>
        </div>
        <div class="stat-item bg-green">
            <h4 id="stat-done">0</h4>
            <b>ØªÙ… Ø­Ù„Ù‡Ø§</b>
        </div>
    </div>

    <div class="glass-card">
        <h3>ğŸ“ˆ ØªØ­Ù„ÙŠÙ„ Ù†Ø´Ø§Ø· Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø´Ø§Ù…Ù„</h3>
        <div class="charts-grid">
            <div class="chart-box">
                <h4>Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h4>
                <canvas id="statusChart"></canvas>
            </div>
            <div class="chart-box">
                <h4>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø®Ø·ÙˆØ±Ø©</h4>
                <canvas id="riskChart"></canvas>
            </div>
            <div class="chart-box">
    <h4>ğŸ† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† (Ø§Ù„Ø£ÙƒØ«Ø± Ø¥Ù†Ø¬Ø§Ø²Ø§Ù‹)</h4>
    <canvas id="companyChart"></canvas>
</div>
        </div>
    </div>
</section>

            <section id="ticket-management" class="section-view">
                <div class="glass-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3>ğŸ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3>
                        <input type="text" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹..." style="width: 200px;">
                    </div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Ø§Ù„Ù…Ø¹Ø±Ù</th>
                                    <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                    <th>Ø§Ù„Ø®Ø·ÙˆØ±Ø©</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                                </tr>
                            </thead>
                            <tbody id="ticket-table-body">
                                </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="admin-management" class="section-view">
    <div class="glass-card">
        <h3>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø±Ù Ø¬Ø¯ÙŠØ¯ (Admin/Super Admin)</h3>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; background: #f9f9f9; padding: 20px; border-radius: 10px;">
            <div class="input-group">
                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                <input type="text" id="new-admin-name" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³Ø¹ÙŠØ¯">
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="new-admin-email" placeholder="email@example.com">
            </div>
            <div class="input-group">
                <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
                <input type="text" id="new-admin-phone" placeholder="05xxxxxxxx">
            </div>
            <div class="input-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                <input type="password" id="new-admin-pass" placeholder="********">
            </div>
            <div class="input-group">
                <label>Ù†ÙˆØ¹ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label>
                <select id="new-admin-role">
                    <option value="admin">Ø£Ø¯Ù…Ù† Ø¹Ø§Ø¯ÙŠ (Admin)</option>
                    <option value="super">Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù† (Super Admin)</option>
                </select>
            </div>
            <div class="input-group" style="display: flex; align-items: flex-end;">
                <button class="btn btn-success" onclick="addNewAdmin()" style="width: 100%; justify-content: center;">Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯ </button>
            </div>
        </div>

        <hr style="border: 0.5px solid #eee; margin: 20px 0;">

        <h3>ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
                        <th>Ø§Ù„Ø¬ÙˆØ§Ù„</th>
                        <th>Ø§Ù„Ø¯ÙˆØ±</th>
                        <th>Ø§Ù„ØªØ­ÙƒÙ…</th>
                    </tr>
                </thead>
                <tbody id="admin-table-body">
                    </tbody>
            </table>
        </div>
    </div>
</section>
        </div>
    </div>

    <div id="reply-modal" class="overlay">
    <div class="glass-card" style="width: 500px; max-height: 90vh; overflow-y: auto;">
        <h3 id="modal-ticket-id">ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒØ±Ø©</h3>
        
        <div style="margin-bottom: 20px; text-align: center; background: #f0f0f0; border-radius: 10px; padding: 10px;">
            <label style="display: block; text-align: right; margin-bottom: 10px;">ğŸ“¸ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ù…Ø±ÙÙ‚Ø©:</label>
            <img id="view-u-file" src="" alt="Ø§Ù„Ù…Ø±ÙÙ‚" style="max-width: 100%; border-radius: 8px; display: none;">
            <p id="no-image-text" style="color: #888; padding: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ù…Ø±ÙÙ‚Ø©</p>
        </div>

        <div class="input-group">
            <label>Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Reply)</label>
            <textarea id="admin-reply-text" rows="3"></textarea>
        </div>
            <div class="input-group">
                <label>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</label>
                <select id="admin-status-select">
                    <option value="Done">âœ… ØªÙ… Ø§Ù„Ø­Ù„ (Done)</option>
                    <option value="Not Done Yet">â³ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø­Ù„ Ø¨Ø¹Ø¯ (Not Done)</option>
                </select>
            </div>
            <div class="input-group">
                <label>ØªÙˆØ«ÙŠÙ‚ Ø§Ù„Ø­Ù„ (ØµÙˆØ±Ø© Ø§Ù„ØªÙ‚ÙÙŠÙ„)</label>
                <input type="file">
            </div>
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-success" onclick="submitReply()">Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚</button>
                <button class="btn" onclick="closeModal()">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>

    <script>
    // 1. Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… (Ø§Ù„ØªØ°Ø§ÙƒØ± ÙˆØ§Ù„Ù…Ø´Ø±ÙÙŠÙ†)
    let tickets = JSON.parse(localStorage.getItem('pro_tickets')) || [];
    
    let adminUsers = JSON.parse(localStorage.getItem('pro_admins')) || [
        { name: 'admin', email: 'admin@system.com', phone: '0500000000', pass: '123', role: 'admin' },
        { name: 'super', email: 'super@system.com', phone: '0511111111', pass: '123', role: 'super' }
    ];

    let currentUser = null; 
    let activeTicketIndex = null;

    // 2. ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª (Tabs)
    function switchTab(tabId, el) {
    document.querySelectorAll('.section-view').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    
    const targetSection = document.getElementById(tabId);
    if (targetSection) targetSection.classList.add('active');
    if (el) el.classList.add('active');
    
    const titles = {
        'user-portal': 'Ø¨ÙˆØ§Ø¨Ø© ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨Ø§Øª',
        'track-status': 'ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨',
        'login-view': 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„',
        'admin-dashboard': 'Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù…Ø©',
        'ticket-management': 'Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ°Ø§ÙƒØ±',
        'admin-management': 'Ø¥Ø¯Ø§Ø±Ø© ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†'
    };
    document.getElementById('view-title').innerText = titles[tabId] || 'Ø§Ù„Ù†Ø¸Ø§Ù…';
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙ‚Ø· ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†
    const printBtn = document.getElementById('print-action-container');
    if (tabId === 'ticket-management' && currentUser) {
        printBtn.style.display = 'block';
    } else {
        printBtn.style.display = 'none';
    }

    if(tabId === 'ticket-management') renderTickets();
    if(tabId === 'admin-dashboard') updateStats();
    if(tabId === 'admin-management') renderAdmins();
}

    // 3. Ø¯Ø§Ù„Ø© ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ°ÙƒØ±Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function trackTicket() {
        const inputField = document.getElementById('track-id-input');
        const searchId = inputField.value.trim().toUpperCase();
        const resultDiv = document.getElementById('track-result');
        
        if (!searchId) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø© Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }

        const ticket = tickets.find(t => t.id === searchId || t.id === 'TKT-' + searchId);

        if (ticket) {
            resultDiv.style.display = 'block';
            document.getElementById('res-status').innerHTML = `
                <span class="badge ${ticket.status === 'Done' ? 'badge-done' : 'badge-pending'}">
                    ${ticket.status === 'Done' ? 'âœ… ØªÙ… Ø§Ù„Ø­Ù„' : 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©'}
                </span>`;
            document.getElementById('res-date').innerText = ticket.date;
            document.getElementById('res-desc').innerText = ticket.desc;
            
            const replyBox = document.getElementById('res-reply');
            if (ticket.reply) {
                replyBox.innerText = ticket.reply;
                replyBox.style.background = "#e8f5e9"; 
                replyBox.style.color = "#2e7d32";
            } else {
                replyBox.innerText = "ØªØ°ÙƒØ±ØªÙƒ ÙˆØµÙ„Øª Ù„ÙØ±ÙŠÙ‚Ù†Ø§ØŒ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø±Ø¯ Ù‡Ù†Ø§ Ù‚Ø±ÙŠØ¨Ø§Ù‹.";
                replyBox.style.background = "#fff3e0";
                replyBox.style.color = "#ef6c00";
            }
        } else {
            resultDiv.style.display = 'none';
            alert('âŒ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');
        }
    }

    // 4. Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    function handleLogin() {
        const userInput = document.getElementById('login-user').value.trim().toLowerCase();
        const passInput = document.getElementById('login-pass').value;

        const userFound = adminUsers.find(u => 
            (u.email.toLowerCase() === userInput || u.name.toLowerCase() === userInput) && u.pass === passInput
        );

        if(userFound) {
            currentUser = userFound;
            document.getElementById('admin-links').style.display = 'block';
            document.getElementById('user-badge').innerText = `Ù…Ø±Ø­Ø¨Ø§Ù‹: ${currentUser.name} `;
            document.getElementById('user-badge').className = 'badge badge-done';
            
            const superLinks = document.getElementById('super-admin-only');
            if(currentUser.role === 'super') {
                superLinks.style.display = 'block';
            } else {
                superLinks.style.display = 'none';
            }
            
            switchTab('admin-dashboard', document.querySelectorAll('.nav-item')[2]);
        } else {
            alert('âŒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
        }
    }

    function logout() {
        currentUser = null;
        location.reload(); 
    }

    // 5. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø±ÙÙŠÙ†
    function renderAdmins() {
        const tableBody = document.getElementById('admin-table-body');
        if(!tableBody) return;
        tableBody.innerHTML = '';

        adminUsers.forEach((admin, index) => {
            tableBody.innerHTML += `
                <tr>
                    <td><b>${admin.name}</b></td>
                    <td>${admin.email}</td>
                    <td>${admin.phone}</td>
                    <td><span class="badge ${admin.role === 'super' ? 'badge-done' : 'badge-pending'}">
                        ${admin.role === 'super' ? 'Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù†' : 'Ø£Ø¯Ù…Ù† Ø¹Ø§Ø¯ÙŠ'}
                    </span></td>
                    <td>
                        ${admin.email !== 'super@system.com' ? 
                        `<button class="btn btn-danger" style="padding:4px 10px;" onclick="deleteAdmin(${index})">
                            <i class="fas fa-trash"></i> Ø­Ø°Ù
                        </button>` : 'Ø­Ø³Ø§Ø¨ Ø£Ø³Ø§Ø³ÙŠ'}
                    </td>
                </tr>
            `;
        });
    }

    function addNewAdmin() {
        const name = document.getElementById('new-admin-name').value;
        const email = document.getElementById('new-admin-email').value;
        const phone = document.getElementById('new-admin-phone').value;
        const pass = document.getElementById('new-admin-pass').value;
        const role = document.getElementById('new-admin-role').value;

        if (!name || !email || !pass || !phone) {
            alert('âš ï¸ ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
            return;
        }

        adminUsers.push({ name, email, phone, pass, role });
        localStorage.setItem('pro_admins', JSON.stringify(adminUsers));
        alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯!');
        renderAdmins();
    }

    function deleteAdmin(index) {
        if (confirm('â— Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ØŸ')) {
            adminUsers.splice(index, 1);
            localStorage.setItem('pro_admins', JSON.stringify(adminUsers));
            renderAdmins();
        }
    }

    // 6. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ°Ø§ÙƒØ±
    document.getElementById('ticketForm').onsubmit = function(e) {
    e.preventDefault();
    const fileInput = document.getElementById('u-file');
    const reader = new FileReader();

    reader.onload = function() {
        const newTicket = {
            id: 'TKT-' + Date.now().toString().slice(-4),
            company: document.getElementById('u-company').value,
            name: document.getElementById('u-name').value,
            dept: document.getElementById('u-dept').value,
            risk: document.getElementById('u-risk').value,
            desc: document.getElementById('u-desc').value,
            fileData: reader.result, // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©
            status: 'Not Done Yet',
            reply: '',
            date: new Date().toLocaleDateString()
        };
        tickets.push(newTicket);
        localStorage.setItem('pro_tickets', JSON.stringify(tickets));
        alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ø±Ù‚Ù…: ' + newTicket.id);
        document.getElementById('ticketForm').reset();
    };
    if (fileInput.files[0]) { reader.readAsDataURL(fileInput.files[0]); }
};

    // --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø­Ø°Ù Ù„Ù„Ø³ÙˆØ¨Ø± Ø£Ø¯Ù…Ù† ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ---
    function renderTickets() {
        const body = document.getElementById('ticket-table-body');
        if(!body) return;
        body.innerHTML = '';
        
        tickets.forEach((t, index) => {
            body.innerHTML += `
                <tr>
                    <td><b>#${t.id}</b></td>
                    <td>${t.name} <br> <small>${t.company}</small></td>
                    <td><span class="badge" style="background:${t.risk==='high'?'#ffebee':'#e3f2fd'}; color:${t.risk==='high'?'#c62828':'#1565c0'}">
                        ${t.risk.toUpperCase()}
                    </span></td>
                    <td><span class="badge ${t.status==='Done'?'badge-done':'badge-pending'}">${t.status}</span></td>
                    <td>
                        <button class="btn btn-primary" style="padding:4px 8px;" onclick="openReplyModal(${index})">
                            <i class="fas fa-edit"></i> Ø§Ù„Ø±Ø¯ ${currentUser && currentUser.role === 'super' ? '/ ØªØ¹Ø¯ÙŠÙ„' : ''}
                        </button>
                        ${currentUser && currentUser.role === 'super' ? `
                        <button class="btn btn-danger" style="padding:4px 8px; margin-right:5px;" onclick="deleteTicket(${index})">
                            <i class="fas fa-trash"></i> Ø­Ø°Ù
                        </button>` : ''}
                    </td>
                </tr>
            `;
        });
    }

    // --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒØ±Ø© ---
    function deleteTicket(index) {
        if (confirm('â— Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØªØ°ÙƒØ±Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ')) {
            tickets.splice(index, 1);
            localStorage.setItem('pro_tickets', JSON.stringify(tickets));
            renderTickets();
            updateStats();
        }
    }

    function openReplyModal(index) {
    activeTicketIndex = index;
    const t = tickets[index];
    document.getElementById('modal-ticket-id').innerText = `Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ°ÙƒØ±Ø© #${t.id}`;
    document.getElementById('admin-reply-text').value = t.reply;

    const imgTag = document.getElementById('view-u-file');
    const noImgText = document.getElementById('no-image-text');

    if (t.fileData) {
        imgTag.src = t.fileData;
        imgTag.style.display = 'block';
        noImgText.style.display = 'none';
    } else {
        imgTag.style.display = 'none';
        noImgText.style.display = 'block';
    }
    document.getElementById('reply-modal').style.display = 'flex';
}

    function closeModal() {
        document.getElementById('reply-modal').style.display = 'none';
    }

    // --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ø³ÙˆØ¨Ø± Ù…Ù† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø±Ø¯ Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„ ---
    function submitReply() {
    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø±Ø¯ ÙˆØ§Ù„Ø­Ø§Ù„Ø©
    tickets[activeTicketIndex].reply = document.getElementById('admin-reply-text').value;
    tickets[activeTicketIndex].status = document.getElementById('admin-status-select').value;
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø°ÙŠ Ù‚Ø§Ù… Ø¨Ø§Ù„Ø±Ø¯ (Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
    if(tickets[activeTicketIndex].status === 'Done') {
        tickets[activeTicketIndex].repliedBy = currentUser.name; 
    }
    
    localStorage.setItem('pro_tickets', JSON.stringify(tickets));
    closeModal();
    renderTickets();
    updateStats(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙÙˆØ±Ø§Ù‹
    alert('ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø¯ ÙˆØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²');
}

    let myChart = null;
    let sChart = null, rChart = null, cChart = null;

    function updateStats() {
    const total = tickets.length;
    const pending = tickets.filter(t => t.status !== 'Done').length;
    const done = tickets.filter(t => t.status === 'Done').length;

    document.getElementById('stat-total').innerText = total;
    document.getElementById('stat-pending').innerText = pending;
    document.getElementById('stat-done').innerText = done;

    const ctxS = document.getElementById('statusChart').getContext('2d');
    if (sChart) sChart.destroy();
    sChart = new Chart(ctxS, {
        type: 'doughnut',
        data: {
            labels: ['Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±', 'ØªÙ… Ø§Ù„Ø­Ù„'],
            datasets: [{
                data: [pending, done],
                backgroundColor: ['#f59e0b', '#10b981'],
                borderWidth: 0,
                borderRadius: 5
            }]
        },
        options: { cutout: '75%', plugins: { legend: { position: 'bottom' } } }
    });

    const high = tickets.filter(t => t.risk === 'high').length;
    const med = tickets.filter(t => t.risk === 'medium').length;
    const low = tickets.filter(t => t.risk === 'low').length;

    const ctxR = document.getElementById('riskChart').getContext('2d');
    if (rChart) rChart.destroy();
    rChart = new Chart(ctxR, {
        type: 'polarArea',
        data: {
            labels: ['Ø¹Ø§Ù„ÙŠØ©', 'Ù…ØªÙˆØ³Ø·Ø©', 'Ù…Ù†Ø®ÙØ¶Ø©'],
            datasets: [{
                data: [high, med, low],
                backgroundColor: ['#ef4444aa', '#3b82f6aa', '#94a3b8aa']
            }]
        },
        options: { plugins: { legend: { position: 'bottom' } } }
    });

    // --- Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§: Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† Ø¨Ø±Ø³Ù… Ø¹Ù…ÙˆØ¯ÙŠ (Vertical Bar) ---
    const solvedTickets = tickets.filter(t => t.status === 'Done' && t.repliedBy);
    const admins = [...new Set(solvedTickets.map(t => t.repliedBy))];
    const dataA = admins.map(a => solvedTickets.filter(t => t.repliedBy === a).length);

    const ctxC = document.getElementById('companyChart').getContext('2d');
    if (cChart) cChart.destroy();
    cChart = new Chart(ctxC, {
        type: 'bar',
        data: {
            labels: admins, 
            datasets: [{
                label: 'ØªØ°Ø§ÙƒØ± ØªÙ… Ø­Ù„Ù‡Ø§',
                data: dataA,
                backgroundColor: '#2EB886', 
                borderRadius: 5
            }]
        },
        options: { 
            // ØªÙ… Ø­Ø°Ù indexAxis: 'y' Ù„ÙŠØ¹ÙˆØ¯ Ø§Ù„Ø±Ø³Ù… Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ ÙƒÙ…Ø§ ÙÙŠ Ø·Ù„Ø¨Ùƒ
            scales: { 
                y: { beginAtZero: true, grid: { display: true } }, 
                x: { grid: { display: false } } 
            },
            plugins: { 
                legend: { display: false } 
            }
        }
    });
}
	
	
	
// --- Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© Ø§Ù„ØªÙŠ ØªÙ… Ø¥Ø¹Ø§Ø¯ØªÙ‡Ø§ Ù„Ø¥ØµÙ„Ø§Ø­ Ø²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± ---
async function exportToPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p', 'pt', 'a4');

    // Ø­Ø³Ø§Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const totalSolved = tickets.filter(t => t.status === 'Done').length;
    const totalPending = tickets.filter(t => t.status !== 'Done').length;

    // ØªØµÙ…ÙŠÙ… Ø±Ø£Ø³ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
    doc.setFontSize(18);
    doc.setTextColor(44, 62, 80);
    doc.text("HAKA IT SYSTEM - Monthly Report", 40, 50);
    
    doc.setFontSize(10);
    doc.setTextColor(100);
    doc.text(`Report Date: ${new Date().toLocaleString()}`, 40, 75);
    doc.text(`Generated by Admin: ${currentUser.name}`, 40, 90);

    // Ù…Ù„Ø®Øµ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª (Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠØ© ÙÙŠ Ø§Ù„ØªÙ‚Ø±ÙŠØ±)
    doc.setDrawColor(46, 184, 134); 
    doc.setLineWidth(1);
    doc.rect(40, 105, 515, 45); 
    
    doc.setFontSize(11);
    doc.setTextColor(0);
    doc.text(`Total Solved: ${totalSolved} Tickets`, 60, 132);
    doc.text(`Total Unsolved: ${totalPending} Tickets`, 250, 132);

    // Ø¨Ù†Ø§Ø¡ Ù…ØµÙÙˆÙØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¬Ø¯ÙˆÙ„
    const tableData = tickets.map(t => [
        t.id,
        t.name,
        t.dept,
        t.company,
        t.repliedBy ? t.repliedBy : "N/A", // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ù† Ù‚Ø§Ù… Ø¨Ø§Ù„Ø±Ø¯
        t.status === 'Done' ? 'Completed' : 'Pending'
    ]);

    // Ø±Ø³Ù… Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… AutoTable
    doc.autoTable({
        startY: 170,
        head: [['Ticket ID', 'Employee', 'Department', 'Company', 'Resolved By', 'Status']],
        body: tableData,
        headStyles: { fillColor: [44, 62, 80], halign: 'center' },
        styles: { fontSize: 9, halign: 'center' },
        columnStyles: {
            0: { fontStyle: 'bold' },
            4: { textColor: [46, 184, 134], fontStyle: 'bold' }
        }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
    doc.save(`HAKA_IT_Report_${Date.now()}.pdf`);
    alert('ğŸš€ ØªÙ… ØªØ¬Ù‡ÙŠØ² ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!');
}
</script>

<div id="print-action-container" style="display: none;">
    <button class="btn btn-success" onclick="exportToPDF()" 
            style="position: fixed; bottom: 30px; left: 30px; padding: 15px 25px; 
                   box-shadow: 0 8px 20px rgba(0,0,0,0.3); z-index: 9999; border-radius: 50px;
                   font-size: 12px; border: 2px solid white;">
        <i class="fas fa-file-export"></i> ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØ°Ø§ÙƒØ± (PDF)
    </button>
</div>

</body>
</html>